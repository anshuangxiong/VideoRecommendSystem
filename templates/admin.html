<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>推荐系统后台管理</title>
    <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
    <link rel="stylesheet" href="../static/user/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.5.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/ionicons/2.0.1/css/ionicons.min.css">
    <link rel="stylesheet" href="../static/user/dist/css/AdminLTE.min.css">
    <link rel="stylesheet" href="../static/user/dist/css/skins/_all-skins.min.css">
    <link rel="stylesheet" type="text/css" href="../static/js/bootstrapTable/bootstrap-table.css"/>
</head>
<body class="hold-transition skin-blue fixed sidebar-mini">
<div class="wrapper">

    <header class="main-header">
        <a class="logo">
            <span class="logo-mini"><b>A</b>dmin</span>
            <span class="logo-lg"><b>推荐系统</b>后台管理</span>
        </a>
        <nav class="navbar navbar-static-top">
            <a href="#" class="sidebar-toggle" data-toggle="offcanvas" role="button">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </a>

            <div class="navbar-custom-menu">
                <ul class="nav navbar-nav">
                    <li class="dropdown user user-menu">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                            <img src="../static/user/dist/img/user2-160x160.jpg" class="user-image" alt="User Image">
                            <span class="hidden-xs">Alexander Pierce</span>
                        </a>
                        <ul class="dropdown-menu">
                            <!-- User image -->
                            <li class="user-header">
                                <img src="../static/user/dist/img/user2-160x160.jpg" class="img-circle"
                                     alt="User Image">

                                <p>
                                    Alexander Pierce - Web Developer
                                    <small>Member since Nov. 2012</small>
                                </p>
                            </li>
                            <!-- Menu Body -->
                            <li class="user-body">
                                <div class="row">
                                    <div class="col-xs-4 text-center">
                                        <a href="#">Followers</a>
                                    </div>
                                    <div class="col-xs-4 text-center">
                                        <a href="#">Sales</a>
                                    </div>
                                    <div class="col-xs-4 text-center">
                                        <a href="#">Friends</a>
                                    </div>
                                </div>
                                <!-- /.row -->
                            </li>
                            <!-- Menu Footer-->
                            <li class="user-footer">
                                <div class="pull-left">
                                    <a href="#" class="btn btn-default btn-flat">Profile</a>
                                </div>
                                <div class="pull-right">
                                    <a href="#" class="btn btn-default btn-flat">Sign out</a>
                                 </div>
                            </li>
                        </ul>
                    </li>
                </ul>
            </div>
        </nav>
    </header>

    <!-- =============================================== -->

    <aside class="main-sidebar">
        <section class="sidebar">
            <div class="user-panel">
                <div class="pull-left image">
                    <img src="../static/user/dist/img/user2-160x160.jpg" class="img-circle" alt="User Image">
                </div>
                <div class="pull-left info">
                    <p>Alexander Pierce</p>
                    <a href="#"><i class="fa fa-circle text-success"></i> Online</a>
                </div>
            </div>
            <!-- search form -->
            <form action="#" method="get" class="sidebar-form">
                <div class="input-group">
                    <input type="text" name="q" class="form-control" placeholder="Search...">
                    <span class="input-group-btn">
                <button type="submit" name="search" id="search-btn" class="btn btn-flat"><i class="fa fa-search"></i>
                </button>
              </span>
                </div>
            </form>
            <ul class="sidebar-menu">
                <li class="header">MAIN NAVIGATION</li>
                <li class="active"><a href="#" id="video_manager"><i class="fa fa-video-camera"></i> <span>视频管理</span></a></li>
                <li><a href="#" id="user_manager"><i class="fa fa-user"></i> <span>用户管理</span></a></li>
                <li class="treeview">
                    <a href="#"><i class="fa fa-superscript"></i> <span>算法优化</span> <i class="fa fa-angle-left pull-right"></i></a>
                    <ul class="treeview-menu">
                        <li><a href="#">相似度</a></li>
                        <li><a href="#">推荐度</a></li>
                    </ul>
                </li>
            </ul>
        </section>
    </aside>

    <!-- =============================================== -->

    <div class="content-wrapper">
        <section class="content-header">
        </section>
        <!-- Main content -->
        <section class="content">
            <div class="row">
                <div class="col-xs-12">
                    <div class="box">
                        <div class="box-header" >
                            <div id="toolbar"   class="btn-group">
                                <button id="btn_add" type="button" class="btn btn-default btn-sm">
                                    <span class="glyphicon glyphicon-plus" aria-hidden="true"></span>新增
                                </button>
                            </div>
                        </div>
                        <!-- /.box-header -->
                        <div class="box-body">
                            <table id="video_user_table" class="table table-bordered table-hover">
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </div>

    <footer class="main-footer">
        <div class="pull-right hidden-xs">
            <b>Version</b> 2.3.7
        </div>
        <strong>Copyright &copy; 2014-2016 <a href="http://almsaeedstudio.com">Almsaeed Studio</a>.</strong> All rights
        reserved.
    </footer>
    <div class="control-sidebar-bg"></div>
</div>

<!-- 修改视频弹框 -->
<div class="modal fade" id="updateVideo" tabindex="-1" role="dialog"
     aria-labelledby="updateVideoLabel">
    <div class="modal-dialog" role="document" style="width: 650px">
        <div class="modal-content">
            <div class="panel panel-default" style="margin-bottom: 0px;">
                <button type="button" class="close" data-dismiss="modal"
                        aria-label="Close">
                    <span aria-hidden="true">×</span>
                </button>
                <div class="panel-heading">修改视频</div>
                <div class="panel-body container-fluid">
                    <div class="row">
                        <input type="hidden" name="utxt_id" class="form-control"
                               id="utxt_id" placeholder="编号">
                        <div class="col-md-6">
                            <label for="txt_name" class="col-sm-4 control-label"
                                   style="margin-top: 6px;">视频名称:</label> <span class="col-sm-8">
										<input type="text" name="utxt_name" class="form-control"
                                               id="utxt_name" placeholder="视频名称">
									</span>
                        </div>
                        <div class="col-md-6">
                            <label for="txt_year" class="col-sm-4 control-label"
                                   style="margin-top: 6px;">年份:</label> <span class="col-sm-8">
										<input type="text" name="utxt_year" class="form-control"
                                               id="utxt_year" placeholder="年份">
									</span>
                        </div>
                    </div>
                    <div class="row" style="margin-top: 15px;">
                        <div class="col-md-12">
                            <label for="txt_genres" class="col-sm-2 control-label"
                                   style="margin-top: 6px;">类别:</label> <span class="col-sm-10">
										<textarea id="utxt_genres" class="form-control" rows="3"></textarea>
                            </select>
									</span>
                        </div>

                    </div>

                    <div class="row"
                         style="float: right; margin-right: 0px; margin-top: 13px;">
                        <div class="">
                            <button type="button" class="btn btn-default btn-sm"
                                    data-dismiss="modal">
                                <span class="glyphicon glyphicon-remove" aria-hidden="true"></span>关闭
                            </button>
                            <button type="button" id="btn_update_submit"
                                    class="btn btn-primary btn-sm" data-dismiss="modal">
										<span class="glyphicon glyphicon-floppy-disk"
                                              aria-hidden="true"></span>修改
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- 新增视频窗口-->
<div class="modal fade" id="addVideo" tabindex="-1" role="dialog"
     aria-labelledby="addVideoLabel">
    <div class="modal-dialog" role="document" style="width: 650px">
        <div class="modal-content">
            <div class="panel panel-default" style="margin-bottom: 0px;">
                <button type="button" class="close" data-dismiss="modal"
                        aria-label="Close">
                    <span aria-hidden="true">×</span>
                </button>
                <div class="panel-heading">新增视频</div>
                <div class="panel-body container-fluid">
                    <div class="row">
                        <div class="col-md-6">
                            <label for="txt_name" class="col-sm-4 control-label"
                                   style="margin-top: 6px;">视频名称:</label> <span class="col-sm-8">
										<input type="text" class="form-control" id="txt_name">
									</span>
                        </div>
                        <div class="col-md-6">
                            <label for="txt_year" class="col-sm-4 control-label"
                                   style="margin-top: 6px;">年份:</label> <span class="col-sm-8">
										<input type="text" class="form-control" id="txt_year">
									</span>
                        </div>
                    </div>
                    <div class="row" style="margin-top: 15px;">
                        <div class="col-md-12">
                            <label for="txt_genres" class="col-sm-2 control-label" style="margin-top: 6px;">类别:</label>
                            <span class="col-sm-10">
                                <textarea id="txt_genres" class="form-control" rows="3"></textarea>
							</span>
                        </div>

                    </div>

                    <div class="row"
                         style="float: right; margin-right: 0px; margin-top: 13px;">
                        <div class="">
                            <button type="button" class="btn btn-default btn-sm"
                                    data-dismiss="modal">
                                <span class="glyphicon glyphicon-remove" aria-hidden="true"></span>关闭
                            </button>
                            <button type="button" id="btn_add_submit"
                                    class="btn btn-primary btn-sm" data-dismiss="modal">
										<span class="glyphicon glyphicon-floppy-disk"
                                              aria-hidden="true"></span>保存
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="../static/user/plugins/jQuery/jquery-2.2.3.min.js"></script>
<script src="../static/user/bootstrap/js/bootstrap.min.js"></script>
<script src="../static/user/plugins/slimScroll/jquery.slimscroll.min.js"></script>
<script src="../static/user/plugins/fastclick/fastclick.js"></script>
<script src="../static/user/dist/js/app.min.js"></script>
<script src="../static/user/dist/js/demo.js"></script>
<script type="text/javascript" src="../static/js/bootstrapTable/bootstrap-table.js"></script>
<script type="text/javascript" src="../static/js/bootstrapTable/bootstrap-table-locale-all.js"></script>
<script type="text/javascript" src="../static/js/layer/layer.js"></script>
<script>

    $(function () {
        TableInit("../administrator/videoList");

        //新增按钮点击事件
        $("#btn_add").on("click", function () {
            $('#addVideoLabel').text("新增视频信息");
            $('#addVideo').modal({
                //点击ESC键,模态窗口即会退出。
                keyboard: true
            });
        });

    });

    $("#video_manager").click(function () {
        $("#video_user_table").bootstrapTable('destroy');
        TableInit("../administrator/videoList");
    });
    $("#user_manager").click(function () {
        $("#video_user_table").bootstrapTable('destroy');
        TableInit("../administrator/userList");
    });


    function TableInit(url) {
        var commom_attr = {
            //请求地址
            url: url,
            //请求方式
            method: 'post',
            //请求内容类型
            contentType: "application/x-www-form-urlencoded",
            //数据类型
            dataType: "json",
            //table高度，
            //如果没有设置height属性，
            //表格自动根据记录条数觉得表格高度
            height: '482',
            //是否显示行间隔色
            striped: true,
            //是否启用排序
            sortable: false,
            //排序方式
            sortOrder: "asc",
            //是否使用缓存
            cache: false,
            //每行的唯一标识
            uniqueId: "id",
            //指定工具栏
            toolbar: "#toolbar",
            //显示隐藏列
            showColumns: false,
            //显示刷新按钮
            showRefresh: false,
            //切换显示样式
            showToggle: false,
            //显示Table脚部
            showFooter: false,
            //是否显示详细视图
            cardView: false,
            //是否显示父子表，是否显示详情
            detailView: false,
            //detail格式化
            //detailFormatter: genderDetail,
            //是否显示分页
            pagination: true,
            //是否显示分页按钮
            showPaginationSwitch: false,
            //是否启用点击选中行
            clickToSelect: false,
            //最少要显示的列数
            minimumCountColumns: 2,
            //cell没有值时显示
            undefinedText: '-',
            //分页方式：client客户端分页，server服务端分页
            //sidePagination: "server",
            //每页的记录行数
            pageSize: 10,
            //初始化加载第1页，默认第1页
            pageNumber: 1,
            //可供选择的每页的行数
            pageList: "[10, 25, 50, 80, 100, 200, 300]",
            paginationFirstText: "首页",
            paginationPreText: "上一页",
            paginationNextText: "下一页",
            paginationLastText: "末页",
            buttonsClass: 'default',
            iconsPrefix: 'glyphicon',
            //queryParams: queryParams,
            icons: {
                paginationSwitchDown: 'glyphicon-collapse-down icon-chevron-down',
                paginationSwitchUp: 'glyphicon-collapse-up icon-chevron-up',
                refresh: 'glyphicon-refresh icon-refresh',
                toggle: 'glyphicon-list-alt icon-list-alt',
                columns: 'glyphicon-th icon-th',
                detailOpen: 'glyphicon-plus icon-plus',
                detailClose: 'glyphicon-minus icon-minus'
            },
            columns: [],
            onLoadSuccess: function () {
                {% comment %}layer.msg("加载成功!", {
                    icon: 1,
                    time: 2000
                });{% endcomment %}
            },
            onLoadError: function () {
                //加载失败时执行
                layer.msg("加载失败!", {
                    icon: 2,
                    time: 2000
                });
            },
            formatLoadingMessage: function () {
                //正在加载
                return "请稍等，正在加载中...";
            },
            formatNoMatches: function () {
                //没有匹配的结果
                return '无符合条件的记录';
            }
        };


        //先销毁表格
        $("#video_user_table").bootstrapTable('destroy');
        if (url == "../administrator/videoList") {
            $("#toolbar").show();
            commom_attr['columns'] = [{
                title: '序号',
                field: 'id',
                align: 'center',
                valign: 'middle',
            }, {
                title: '电影名称',
                field: 'movie_title',
                align: 'center',
                valign: 'middle'
            }, {
                title: '类别',
                field: 'genres',
                align: 'center',
                valign: 'middle'
            }, {
                title: '年份',
                field: 'year',
                align: 'center',
                valign: 'middle'
            },{
                title: '操作',
                field: 'operate',
                align: 'center',
                events : operateEvents,
                formatter: genderOpt
            }];
            $("#video_user_table").bootstrapTable(commom_attr);
        } else {
            $("#toolbar").hide();
            commom_attr['columns'] = [{
                title: '序号',
                field: 'id',
                align: 'center',
                valign: 'middle',
            }, {
                title: '用户名称',
                field: 'username',
                align: 'center',
                valign: 'middle'
            }, {
                title: '邮箱',
                field: 'email',
                align: 'center',
                valign: 'middle'
            }, {
                title: '喜欢类型',
                field: 'hobby',
                align: 'center',
                valign: 'middle'
            }, {
                title: '操作',
                field: 'state',
                align: 'center',
                events : operateEvents,
                formatter: genderUserOpt
            }];
            $("#video_user_table").bootstrapTable(commom_attr);
        }

    }

    //自定义列内容
    function genderOpt() {
        return ['<a id="edit" href="javascript:void(0)" title="编辑">',
            '<i class="glyphicon glyphicon-pencil"></i>', '</a>  ',
            '<a id="remove" href="javascript:void(0)" title="删除">',
            '<i class="glyphicon glyphicon-trash"></i>', '</a>'].join('');
    }

    //自定义列内容
    function genderUserOpt(value) {
        if(value==1){
            return '<button type="button" id="stop_btn" class="btn  btn-danger btn-sm">禁用</button>'
        }else{
             return '<button type="button" id="start_btn" class="btn  btn-success btn-sm">启用</button>'
        }
    }
    //自定义列内容事件
    window.operateEvents = {
        'click #edit': function (e, value, row, index) {
            editData(row);
        },
        'click #remove': function (e, value, row, index) {
            delOneData(row.id);
        },
        'click #stop_btn': function (e, value, row, index) {
            userManager(row.id,0);
        },
        'click #start_btn': function (e, value, row, index) {
            userManager(row.id,1);
        }
    };

    function userManager(id, state) {
        $.ajax({
            url: '../administrator/userState',
            method: 'post',
            contentType: "application/x-www-form-urlencoded",
            data: {
                id: id,
                state: state,
            },
            //阻止深度序列化，向后台传送数组
            traditional: true,
            success: function (msg) {
                var msg = JSON.parse(msg);
                if (msg.code == '0000') {
                    layer.msg(msg.info, {icon: 1, time: 1500, area: ['60px', '66px']});
                } else {
                    layer.msg(msg.info, {icon: 2, time: 1500});
                }
                refresh();
            }
        });
    }

    //行末-编辑按钮点击事件
    function editData(row) {
        //向模态框中传值
        $('#utxt_id').val(row.id);
        $('#utxt_name').val(row.movie_title);
        $('#utxt_year').val(row.year);
        $('#utxt_genres').val(row.genres);

        $('#updateVideoLabel').text("修改视频信息");

        //显示模态窗口
        $('#updateVideo').modal({
            //点击ESC键,模态窗口即会退出。
            keyboard: true
        });
    }

    //弹框中-修改保存按钮点击事件
    $("#btn_update_submit").off().on('click', function () {

        var id = $('#utxt_id').val(),
            name = $('#utxt_name').val(),
            year = $('#utxt_year').val(),
            genres = $('#utxt_genres').val();

        //验证数据
        if (!name) {
            layer.msg('请填写视频名称!', {icon: 2, time: 1500});
            return false;
        }
        if (!year) {
            layer.msg('请填写视频年份!', {icon: 2, time: 1500});
            return false;
        }

        $.ajax({
            url: '../administrator/updateVideo',
            method: 'post',
            contentType: "application/x-www-form-urlencoded",
            data: {
                id: id,
                name: name,
                year: year,
                genres: genres
            },
            //阻止深度序列化，向后台传送数组
            traditional: true,
            success: function (msg) {
                var msg = JSON.parse(msg);
                if (msg.code == '0000') {
                    layer.msg(msg.info, {icon: 1, time: 1500, area: ['60px', '66px']});
                } else {
                    layer.msg(msg.info, {icon: 2, time: 1500});
                }
                refresh();
            }
        })
    });


    //弹框保存按钮点击事件
    $("#btn_add_submit").off().on('click', function () {

        var name = $('#txt_name').val(),
            year = $('#txt_year').val(),
            genres = $('#txt_genres').val();

        //验证数据
        if (!name) {
            layer.msg('请填写视频名称!', {icon: 2, time: 1500});
            return false;
        }
        if (!year) {
            layer.msg('请填写视频年份!', {icon: 2, time: 1500});
            return false;
        }

        $.ajax({
            url: '../administrator/addVideo',
            method: 'post',
            contentType: "application/x-www-form-urlencoded",
            data: {
                name: name,
                year: year,
                genres: genres
            },
            //阻止深度序列化，向后台传送数组
            traditional: true,
            success: function (msg) {
                var msg = JSON.parse(msg);
                if (msg.code == '0000') {
                    layer.msg(msg.info, {icon: 1, time: 1500, area: ['60px', '66px']});
                } else {
                    layer.msg(msg.info, {icon: 2, time: 1500});
                }
                refresh();
            }
        })
    });

    //行末-删除按钮点击事件
    function delOneData(id) {
        layer.confirm('确定要删除电影编号为' + id + '数据?', {icon: 3, title: '提示'}, function () {
            $.ajax({
                url: '../administrator/removeVideo',
                data: {
                    id: id,
                },
                method: 'post',
                contentType: "application/x-www-form-urlencoded",
                //阻止深度序列化，向后台传送数组
                traditional: true,
                success: function (msg) {
                    var msg = JSON.parse(msg);
                    if (msg.code == '0000') {
                        layer.msg(msg.info, {icon: 1, time: 1500, area: ['60px', '66px']});
                        refresh();
                    } else {
                        layer.msg(msg.info, {icon: 2, time: 1500, area: ['60px', '66px']});
                    }
                }
            })
        });
    }


    //刷新页面
    function refresh() {
       $("#video_user_table").bootstrapTable('refresh');
    }

</script>
</body>
</html>
