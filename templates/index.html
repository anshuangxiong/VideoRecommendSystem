<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>个性化视频推荐系统</title>
    <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
   <link rel="stylesheet" href="../static/user/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.5.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/ionicons/2.0.1/css/ionicons.min.css">
    <link rel="stylesheet" href="../static/user/dist/css/AdminLTE.min.css">
    <link rel="stylesheet" href="../static/user/dist/css/skins/_all-skins.min.css">
    <link rel="stylesheet" href="../static/user/plugins/ionslider/ion.rangeSlider.css">
    <link rel="stylesheet" href="../static/user/plugins/ionslider/ion.rangeSlider.skinNice.css">
    <link rel="stylesheet" href="../static/user/plugins/bootstrap-slider/slider.css">
    <link rel="stylesheet" href="../static/user/plugins/iCheck/all.css">
    <link rel="stylesheet" href="../static/user/plugins/colorpicker/bootstrap-colorpicker.min.css">
    <link rel="stylesheet" href="../static/css/hivideo/hivideo.css">
    <style>
        /*视频播放器*/
        .main-wrap {
            margin: 0 auto;
        {% comment %}min-width: 320px;
        max-width: 640px;{% endcomment %}
        }
        .main-wrap video {
            width: 100%;
        }
    </style>

</head>
<body class="hold-transition skin-blue layout-top-nav">
<div class="wrapper">
    <header class="main-header">
        <nav class="navbar navbar-static-top">
            <div class="container">
                <div class="navbar-header">
                    <a class="navbar-brand"><b>个性化</b>视频推荐系统</a>
                    <button type="button" class="navbar-toggle collapsed" data-toggle="collapse"
                            data-target="#navbar-collapse">
                        <i class="fa fa-bars"></i>
                    </button>
                </div>


                <div class="collapse navbar-collapse pull-left" id="navbar-collapse">
                    <ul class="nav navbar-nav" id="nav_ul">
                        <li class="active"><a id="recommend">推荐<span class="sr-only">(current)</span></a></li>
                        <li><a id="comedy" movie_type="Comedy">喜剧</a></li>
                        <li><a id="horror" movie_type="Horror">恐怖</a></li>
                        <li><a id="action" movie_type="Action">动作</a></li>
                        <li><a id="thriller" movie_type="Thriller">科幻</a></li>
                        <li><a id="adventure" movie_type="Adventure">冒险</a></li>
                        <li><a id="mystery" movie_type="Mystery">推理剧</a></li>
                        <li><a id="children" movie_type="Children">动画</a></li>
                        <li><a id="romance" movie_type="Romance">浪漫</a></li>
                    </ul>

                    <form class="navbar-form navbar-left" role="search">
                        <div class="form-group">
                        <input type="text" class="form-control" id="find_text" placeholder="Search">
                            <button type="button" name="search" id="find_button" class="btn btn-flat btn-primary">
                                <i class="fa fa-search"></i>
                            </button>
                        </div>
                    </form>
                </div>
                <div class="navbar-custom-menu pull-right">
                    <ul class="nav navbar-nav" >
                        {% if request.session.username %}
                        <li class="dropdown user user-menu">
                            <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                                <img src="../static/user/dist/img/user2-160x160.jpg" class="user-image"
                                     alt="User Image">
                                <span style="display: none" id="loginuser" >{{ request.session.user.pk }}</span>
                                <span class="hidden-xs" >{{ request.session.username }}</span>
                            </a>
                            <ul class="dropdown-menu">
                                <li class="user-header">
                                    <img src="../static/user/dist/img/user2-160x160.jpg" class="img-circle"
                                         alt="User Image">
                                    <p>
                                        Alexander Pierce - Web Developer
                                        <small>Member since Nov. 2012</small>
                                    </p>
                                </li>
                                <!-- Menu Body -->
                                <li class="user-body">
                                    <div class="row">
                                        <div class="col-xs-4 text-center">
                                            <a href="#">Followers</a>
                                        </div>
                                        <div class="col-xs-4 text-center">
                                            <a href="#">Sales</a>
                                        </div>
                                        <div class="col-xs-4 text-center">
                                            <a href="#">Friends</a>
                                        </div>
                                    </div>
                                </li>
                                <li class="user-footer">
                                    <div class="pull-left">
                                        <a href="#" class="btn btn-default btn-flat">Profile</a>
                                    </div>
                                    <div class="pull-right">
                                        <a  id='logout' class="btn btn-default btn-flat">Sign out</a>
                                    </div>
                                </li>
                            </ul>
                        </li>
                        {% else %}
                            <li><a data-toggle="modal" data-target="#loginModal"><span
                                    class="glyphicon glyphicon-log-in"></span> 登录</a></li>
                        {% endif %}
                    </ul>
                </div>
            </div>
        </nav>
    </header>
    <!-- Full Width Column -->
    <div class="content-wrapper">
        <div class="container1">
            <section class="content-header">
                <h1></h1>
            </section>
            <!-- Main content -->
            <section class="content">
                <div class="row">
                    <div class="col-sm-3">
                        <div class="box box-solid box-primary">
                            <div class="box-header with-border">
                                <h3 class="box-title" id="table_title" >视频列表</h3>
                                <div class="box-tools pull-right">
                                    <button type="button" class="btn btn-warning btn-xs" id="recommend_button">推荐</button>
                                </div>
                            </div>
                            <div class="box-body" style="height:510px;overflow-y:auto;">
                                <table id="movie_list" class="table">
                                    {% comment %}这里放置视频列表{% endcomment %}
                                </table>
                            </div>
                            <div class="box-footer">
                                {% comment %}推荐视频列表{% endcomment %}
                            </div>
                        </div>
                    </div>
                    <div class="col-sm-9">
                        <div class="box box-solid box-primary">
                            <div class="box-header with-border">
                                <h3 class="box-title" id="movie_title">视频名称</h3>
                            </div>
                            <div class="box-body">
                                <div class="row">
                                    <div class="col-sm-9">
                                        <div class="row">
                                            <div class="col-sm-12">
                                               {% comment %} <video ishivideo="true" id="video" autoplay="true" isrotate="false" autoHide="true">
                                            <source id="video_src" src=""
                                                    type="video/mp4">
                                            </video>{% endcomment %}
                                                <img id="detail_img" src="">
                                            </div>

                                        </div>
                                        <div class="row" style="margin-top: 30px">
                                            <div class="col-sm-2">评分：</div>
                                            <div class="col-sm-4" >
                                                <input type="text" value="" id="score_value" class="slider form-control" data-slider-min="0" data-slider-max="5" data-slider-step="0.5" data-slider-value="3" data-slider-orientation="horizontal" data-slider-selection="before" data-slider-tooltip="show" data-slider-id="yellow">
                                            </div>
                                            <div class="col-sm-2">
                                                <button type="button" id="score_btn" class="btn btn-block btn-primary btn-sm">打分</button>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-sm-3">
                                        {% comment %}视频的简介{% endcomment %}
                                        <div class="box box-primary">
                                            <div class="box-header with-border">
                                                <h3 class="box-title">About Me</h3>
                                            </div>
                                            <!-- /.box-header -->
                                            <div class="box-body">
                                                <p class="text-muted" style="display: none" id="detail_id">
                                                </p>
                                                <strong><i class="fa fa-book margin-r-5"></i> Name</strong>
                                                <p class="text-muted" id="detail_name">
                                                </p>

                                                <strong><i class="fa fa-map-marker margin-r-5"></i> Year</strong>
                                                <p class="text-muted" id="detail_year"></p>

                                                <strong><i class="fa fa-user-secret margin-r-5"></i> Director</strong>
                                                <p class="text-muted" id="detail_director"></p>

                                                <strong><i class="fa fa-calculator margin-r-5"></i> Rating</strong>
                                                <p class="text-muted" id="detail_rating"></p>

                                                <strong><i class="fa fa-pencil margin-r-5"></i> GENRES</strong>
                                                <div class="text-muted" id="detail_genres">
                                                </div>

                                                <strong><i class="fa fa-users margin-r-5"></i> Actor</strong>
                                                <div  id="detail_actor" style="height:80px;overflow-y:auto;">
                                                </div>

                                                <strong><i class="fa fa-file-text-o margin-r-5"></i> DESC</strong>
                                                <div id="detail_desc" style="height:80px;overflow-y:auto;">
                                                </div>


                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </div>
    </div>
    {% comment %}<footer class="main-footer">
        <div class="container">
            <div class="pull-right hidden-xs">
                <b>Version</b> 1.0.0
            </div>
            <strong>Copyright &copy; 2014-2016 <a href="http://almsaeedstudio.com">AnXiong</a>.</strong> All
            rights
            reserved.
        </div>
    </footer>{% endcomment %}
</div>
<div class="example-modal" >
    <div class="modal modal-primary1 fade" id="loginModal" tabindex="-1" role="dialog" aria-labelledby="loginModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-body">
                    <div class="hold-transition1 login-page">
                        <div class="login-box">
                            <div class="login-logo">
                                <a href="#">登录</a>
                            </div>
                            <div class="login-box-body">
                                <p class="login-box-msg">Sign in to start your session</p>
                                <form id="login_form" >
                                    <div class="form-group has-feedback">
                                        <input type="email" class="form-control" name="username" placeholder="Username">
                                        <span class="glyphicon glyphicon-envelope  form-control-feedback"></span>
                                    </div>
                                    <div class="form-group has-feedback">
                                        <input type="password" class="form-control" name="pwd" placeholder="Password">
                                        <span class="glyphicon glyphicon-lock p form-control-feedback"></span>
                                    </div>
                                    <div class="row">
                                        <div class="col-xs-8">
                                            <button type="button" id="sub_login" class="btn btn-primary btn-block btn-flat">登录
                                            </button>
                                        </div>

                                    </div>
                                </form>
                                <div class="row" style="margin-top:20px">
                                    <div class="col-xs-6 pull-left"><a href="#" class="pull-left">忘记密码</a></div>
                                    <div class="col-xs-6 pull-right"><a href="#"  data-toggle="modal" data-target="#registerModal" onclick="login_modal_hide()" class="pull-right">新用户注册</a></div>
                                </div>
                            </div>
                            <div class="login-logo">
                                <a href="#"><b>&nbsp;</b></a>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default pull-right" data-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="example-modal">
    <div class="modal  fade" id="registerModal" tabindex="-1" role="dialog"
         aria-labelledby="registerModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-body">
                    <div class="hold-transition register-page">
                        <div class="register-box">
                            <div class="register-logo">
                                <a href="#">新用户注册</a>
                            </div>
                            <div class="register-box-body">
                                <form>
                                    <div class="form-group has-feedback">
                                        <input type="text" class="form-control" id="user_name" placeholder="Full name">
                                        <span class="glyphicon glyphicon-user form-control-feedback"></span>
                                    </div>
                                    <div class="form-group has-feedback">
                                        <input type="email" class="form-control" id="email" placeholder="Email">
                                        <span class="glyphicon glyphicon-envelope form-control-feedback"></span>
                                    </div>
                                    <div class="form-group has-feedback">
                                        <input type="password" class="form-control" id="pwd" placeholder="Password">
                                        <span class="glyphicon glyphicon-lock form-control-feedback"></span>
                                    </div>
                                    <div class="form-group has-feedback">
                                        <input type="password" class="form-control" id="cpwd"
                                               placeholder="Retype password">
                                        <span class="glyphicon glyphicon-log-in form-control-feedback"></span>
                                    </div>
                                    <div class="row">
                                        <div class="col-xs-12">
                                            <div class="box-body">
                                                <!-- checkbox -->
                                                <div class="form-group">
                                                    <div class="row">
                                                        <div class="col-xs-12">
                                                            <label>
                                                                <input type="checkbox" name="video_type" class="flat-red" value="喜剧片" checked>喜剧
                                                            </label>
                                                            <label>
                                                                <input type="checkbox" name="video_type" value="恐怖片" class="flat-red">恐怖
                                                            </label>
                                                            <label>
                                                                <input type="checkbox" name="video_type" value="动作片" class="flat-red">动作
                                                            </label>
                                                            <label>
                                                                <input type="checkbox" name="video_type" value="科幻片" class="flat-red">科幻
                                                            </label>
                                                            <label>
                                                                <input type="checkbox" name="video_type" value="冒险片" class="flat-red">冒险
                                                            </label>
                                                        </div>
                                                    </div>
                                                    <div class="row">
                                                        <div class="col-xs-12"><label>
                                                            <input type="checkbox" name="video_type" value="推理剧" class="flat-red">推理
                                                        </label>
                                                            <label>
                                                                <input type="checkbox" name="video_type" value="动画片" class="flat-red">动画
                                                            </label>
                                                            <label>
                                                                <input type="checkbox" name="video_type" value="浪漫剧"  class="flat-red">浪漫
                                                            </label>
                                                            <label>
                                                                <input type="checkbox" name="video_type" value="奇幻剧" class="flat-red">奇幻
                                                            </label>
                                                            <label>
                                                                <input type="checkbox" name="video_type" value="戏剧" class="flat-red">戏剧
                                                            </label></div>
                                                    </div>
                                                </div>
                                            </div>
                                            <!-- /.box-body -->
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-xs-5">
                                            <button type="button" id="sub_reg"
                                                    class="btn btn-primary btn-block btn-flat">注册
                                            </button>
                                        </div>
                                        <div class="col-xs-4">
                                            <button type="button" data-toggle="modal" data-target="#loginModal" onclick="register_modal_hide()" class="btn btn-success btn-block btn-flat">去登陆
                                            </button>
                                        </div>
                                        <div class="col-xs-3">
                                            <button type="button" class="btn btn-default pull-right" data-dismiss="modal">关闭</button>
                                        </div>
                                    </div>
                                </form>
                            </div>
                            <div class="register-logo">
                                <a href="#"><b>&nbsp;</b></a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- jQuery 2.2.3 -->
<script src="../static/user/plugins/jQuery/jquery-2.2.3.min.js"></script>
<!-- Bootstrap 3.3.6 -->
<script src="../static/user/bootstrap/js/bootstrap.min.js"></script>
<!-- SlimScroll -->
<script src="../static/user/plugins/slimScroll/jquery.slimscroll.min.js"></script>
<!-- FastClick -->
<script src="../static/user/plugins/fastclick/fastclick.js"></script>
<!-- AdminLTE App -->
<script src="../static/user/dist/js/app.min.js"></script>
<!-- AdminLTE for demo purposes -->
<script src="../static/user/dist/js/demo.js"></script>
<!--视频播放器 -->
<script type="text/javascript" src="../static/js/hivideo.js"></script>

<script type="text/javascript" src="../static/js/layer/layer.js"></script>
<!-- Ion Slider -->
<script src="../static/user/plugins/ionslider/ion.rangeSlider.min.js"></script>
<!-- Bootstrap slider -->
<script src="../static/user/plugins/bootstrap-slider/bootstrap-slider.js"></script>

<script src="../static/user/plugins/iCheck/icheck.min.js"></script>
<script>
    var page=1;
    var current_movie_type="";
    var find_text="";
    $(function(){
        $('.slider').slider();

        $('input').iCheck({
      checkboxClass: 'icheckbox_square-blue',
      radioClass: 'iradio_square-blue',
      increaseArea: '20%' // optional
    });
    $('input[type="checkbox"].flat-red, input[type="radio"].flat-red').iCheck({
      checkboxClass: 'icheckbox_flat-blue',
      radioClass: 'iradio_flat-blue'
    });

        recommend_movies(page);
        //给视频分类注册点击事件
        $("#comedy,#horror,#action,#thriller,#adventure,#mystery,#children,#romance,#war").click(function(e){
            find_text='';
            current_movie_type=$(e.target).attr('movie_type');
            page=1;
            //点击非推荐时button的文本显示为更多
            $("#recommend_button").text("更多");
            //设置所有的class为''(都不是激活状态)
            $("#nav_ul").find('li').each(function(){
                $(this).attr('class','');
            });
            //点击的分类设置为激活状态
            $(e.target).parents('li').attr('class','active');
            //表格的表头为点击的标题
            $("#table_title").text($(e.target).attr('movie_type'));
            //请求数据
            get_movie_list('');
        });

        //给更多按钮注册点击事件
        $("#recommend_button").click(function(e){
            page=page+1;
            if($(this).text()!="推荐"){
                get_movie_list(find_text);
            }else{
                recommend_movies(page);
            }
        });

        $("#recommend").click(function(e){
            page=1;
            $("#recommend_button").text("推荐");
            $("#nav_ul").find('li').each(function(){
                $(this).attr('class','');
            });
            $(e.target).parents('li').attr('class','active');
            $("#table_title").text("Recommend");

            recommend_movies(page);
        });
        $('#loginModal').modal('hide');
        $('#registerModal').modal('hide');
        //点击登录按钮
        $("#sub_login").click(function(){
             var username=$("#login_form :input[name='username']").val().trim();
             var pwd=$("#login_form :input[name='pwd']").val().trim();
            // $('#loginModal').modal('show');
            if(username ==''){
                alert('用户名不能为空');
                return;
            }
            else if(pwd ==''){
                alert('密码不能为空');
                return;
            } else {
                $.ajax({
                    url: '../user/login',
                    type: 'post',
                    data: {
                        'username': username,
                        'pwd': pwd,
                    },
                    success: function (msg) {
                        var msg = JSON.parse(msg);
                        if (msg.code == '0000') {
                            window.location.reload();
                        } else {
                            alert("用户名或密码错误")
                        }
                    }
                });
            }
        });
        //点击注册按钮
        $("#sub_reg").click(function(){
            var hobby = getVideoTypes();
            var username=$("#user_name").val();
            var pwd=$("#pwd").val();
            var cpwd=$("#cpwd").val();
            var email=$("#email").val();

            if(username == ''){
                alert("用户名不能为空");
                return;
            }
            else if(pwd == ''){
                alert("密码不能为空");
                return;
            }
            else if(cpwd ==''){
                alert("重复密码不能为空");
                return;
            }
            else if(email==''){
                alert("邮件地址不能为空");
                return;
            }
            else if(pwd!=''&&cpwd!=''&&pwd!=cpwd){
                alert("两次密码输入不一致");
                return;
            }
            //邮箱格式
            else if(email!=''&&!CheckMail(email)){
                alert("邮件地址格式不正确");
                return;
            }
            else if(hobby==''){
                alert("请选择你喜欢的类型");
                return;
            }
            $.ajax({
                url:'../user/register',
                data:{
                    'username':username,
                    'pwd':pwd,
                    'email':email,
                    'hobby':hobby,
                },
                method:'post',
                success:function(msg){
                    var msg = JSON.parse(msg);
                    if(msg.code=='0000'){
                        $('#registerModal').modal('hide');
                        layer.msg("恭喜您"+msg.data['username']+"注册成功", {
                            icon : 1,
                            time : 1500
                        });
                    }else if(msg.code=='0001'){
                        layer.msg("对不起，用户名已经存在", {
                            icon : 2,
                            time : 1500
                        });
                    }else{
                        layer.msg(msg.info, {
                            icon : 2,
                            time : 1500
                        });
                    }
                }
            });
        });

        //点击查找按钮
        $("#find_button").click(function(){
            current_movie_type='';
            page=1;
            find_text = $("#find_text").val().trim();
            if(find_text==''){
                return;
            }else{
                $("#recommend_button").text("更多");
                $("#nav_ul").find('li').each(function(){
                    $(this).attr('class','');
                });
                $("#table_title").text(find_text);
                get_movie_list(find_text);
            }
        });



        $("#logout").click(function () {
            $.ajax({
                url: '../user/logout',
                type: 'post',
                success: function (msg) {
                    var msg = JSON.parse(msg);
                    if (msg.code == '0000') {
                       window.location.reload();
                    }
                }
            });
        });


        $("#score_btn").click(function(){
            //判断用户是否登录，没有登录提示登录
            if ($("#loginuser").text()=='') {
                layer.msg("对不起，您还没有登录", {
                    icon: 2,
                    time: 1500
                });
                return;
            }else{
                $.ajax({
                    url:'../log/score',
                    method:"post",
                    data:{
                        'userId':$("#loginuser").text(),
                        'score':$("#score_value").val(),
                        'movieId':$("#detail_id").text(),
                    },
                    success:function (msg) {
                        var msg = JSON.parse(msg);
                        if (msg.code == '0000') {
                            page=1;
                            layer.msg(msg.info, {
                                icon : 1,
                                time : 1500
                            });
                        }
                    }
                });
            }
        });
    });


    function get_movie_list(findtext) {
        $.ajax({
            url: "../user/list",
            data: {
                'movie_type': current_movie_type,
                'page':page,
                'findtext':findtext,
            },
            method: 'post',
            success: function (msg) {
                var msg = JSON.parse(msg);
                if (msg.code == '0000') {
                    $("#movie_list").html("");
                    msg.data = JSON.parse(msg.data);
                    for (var i = 0; i < msg.data.length; i++) {
                        if(i==0){
                            $("#movie_title").html(msg.data[i]['fields']['title']);
                            $("#detail_id").text(msg.data[i]['pk']);
                            $("#detail_name").text(msg.data[i]['fields']['title']);
                            $("#detail_year").text(msg.data[i]['fields']['year']);
                            $("#detail_director").text(msg.data[i]['fields']['director']);
                            $("#detail_actor").text(msg.data[i]['fields']['leadactors']);
                            $("#detail_rating").text(msg.data[i]['fields']['averating']);
                            $("#detail_img").attr("src",msg.data[i]['fields']['backpost']);
                            $("#detail_genres").html('');
                             var genres =msg.data[i]['fields']['genres'];
                            var genress = genres.split("|");
                            for(var j=0;j<genress.length;j++){
                                if(j>0&&j%3==0){
                                     $("#detail_genres").append("<br>");
                                 }
                                 $("#detail_genres").append("<span class='label label-info' style='margin-left:3px'>"+genress[j]+"</span>");
                            }
                            $("#detail_desc").text(msg.data[i]['fields']['description']);
                        }
                        var tr = $('<tr></tr>');
                        var td = $('<td></td>');
                        var a=$('<img></img>');
                        a.css("height","150px");
                        a.css("cursor","pointer");
                        a.attr("src",msg.data[i]['fields']['picture'])
                        a.attr("movie_id",msg.data[i]['pk']);
                        a.attr("movie_title",msg.data[i]['fields']['title']);
                        a.attr("movie_genres",msg.data[i]['fields']['genres']);
                        a.attr("movie_year",msg.data[i]['fields']['show_year']);
                        a.attr("movie_director",msg.data[i]['fields']['director']);
                        a.attr("movie_rating",msg.data[i]['fields']['averating']);
                        a.attr("movie_actor",msg.data[i]['fields']['leadactors']);
                        a.attr("movie_desc",msg.data[i]['fields']['description']);
                         a.attr("movie_img",msg.data[i]['fields']['backpost']);
                        a.click(function(){
                            var movie_id = $(this).attr("movie_id");
                            var movie_title = $(this).attr("movie_title");
                            $("#movie_title").html(movie_title);
                           {% comment %} $("#video").html("");
                            var src="../static/video/《玩具总动员》.mkv";
                            $("#video").prop("src",src);
                            $("#video")[0].play();{% endcomment %}
                            $("#detail_id").text(movie_id);
                            $("#detail_name").text(movie_title);
                            $("#detail_year").text($(this).attr("movie_year"));
                            $("#detail_director").text($(this).attr("movie_director"));
                            $("#detail_actor").text($(this).attr("movie_actor"));
                            $("#detail_rating").text($(this).attr("movie_rating"));
                            $("#detail_img").attr("src",$(this).attr("movie_img"));
                            var genres = $(this).attr("movie_genres");
                            var genress = genres.split("|");
                            $("#detail_genres").html('');
                            for(var t=0;t<genress.length;t++){
                                if(t>0&&t%3==0){
                                     $("#detail_genres").append("<br>");
                                 }
                                 $("#detail_genres").append("<span class='label label-info' style='margin-left:3px'>"+genress[t]+"</span>");
                            }
                            $("#detail_desc").text($(this).attr("movie_desc"));
                        });
                        td.append(a);
                        var td_info=$('<td></td>');

                        var html='<strong><i class="fa fa-book margin-r-5"></i> 电影名称</strong> ' +
                        '<p class="text-muted" id="detail_name">'+msg.data[i]['fields']['movie_name']+'</p>' +
                        '<strong><i class="fa fa-map-marker margin-r-5"></i> 年代</strong>' +
                        '<p class="text-muted" id="detail_year">'+msg.data[i]['fields']['year']+'</p>' +
                        '<strong><i class="fa fa-list margin-r-5"></i> 类型</strong>' +
                        '<p class="text-muted" id="detail_rating">'+msg.data[i]['fields']['typelist']+'</p>';
                        td_info.html(html);
                         tr.append(td);
                         tr.append(td_info);
                        $("#movie_list").append(tr);
                    }
                }
            }
        });
    }

    function CheckMail(mail) {
        var filter  = /^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/;
        if (filter.test(mail))
            return true;
        else {
            return false;
        }
    }

    function recommend_movies(page){
        $.ajax({
            url:"../recommend/score",
            method:'post',
            data:{
                'page':page
            },
            success:function(msg){
                var msg = JSON.parse(msg);
                console.log(msg);
                if(msg.code=='0000'){
                     $("#movie_list").html("");
                     msg.data=JSON.parse(msg.data);
                     for(var i=0;i<msg.data.length;i++){
                         if(i==0){
                             $("#movie_title").html(msg.data[i]['fields']['title']);
                            $("#detail_id").text(msg.data[i]['pk']);
                            $("#detail_name").text(msg.data[i]['fields']['title']);
                            $("#detail_year").text(msg.data[i]['fields']['show_year']);
                            $("#detail_director").text(msg.data[i]['fields']['director']);
                            $("#detail_actor").text(msg.data[i]['fields']['leadactors']);
                            $("#detail_rating").text(msg.data[i]['fields']['averating']);
                            $("#detail_img").attr("src",msg.data[i]['fields']['backpost']);
                            $("#detail_genres").html('');
                             var genres =msg.data[i]['fields']['genres'];
                            var genress = genres.split("|");
                            for(var j=0;j<genress.length;j++){
                                if(j>0&&j%3==0){
                                     $("#detail_genres").append("<br>");
                                 }
                                 $("#detail_genres").append("<span class='label label-info' style='margin-left:3px'>"+genress[j]+"</span>");
                            }
                            $("#detail_desc").text(msg.data[i]['fields']['description']);
                        }
                         var tr=$('<tr></tr>');
                         var td=$('<td></td>');
                         var a=$('<img></img>');
                         a.css("height","150px");
                         a.css("cursor","pointer");
                         a.attr("src",msg.data[i]['fields']['picture'])
                         a.attr("movie_id",msg.data[i]['pk']);
                         a.attr("movie_title",msg.data[i]['fields']['title']);
                         a.attr("movie_genres", msg.data[i]['fields']['genres']);
                         a.attr("movie_year", msg.data[i]['fields']['show_year']);
                         a.attr("movie_director",msg.data[i]['fields']['director']);
                         a.attr("movie_rating",msg.data[i]['fields']['averating']);
                         a.attr("movie_actor",msg.data[i]['fields']['leadactors']);
                         a.attr("movie_desc", msg.data[i]['fields']['description']);
                         a.attr("movie_img",msg.data[i]['fields']['backpost']);
                         a.click(function () {
                             var movie_id = $(this).attr("movie_id");
                             var movie_title = $(this).attr("movie_title");
                             $("#movie_title").html(movie_title);
                             {% comment %}$("#video").html("");
                             var src="../static/video/前任3：再见前任.mp4";
                             $("#video").prop("src",src);
                            $("#video")[0].play();{% endcomment %}
                              $("#detail_id").text(movie_id);
                             $("#detail_name").text(movie_title);
                             $("#detail_year").text($(this).attr("movie_year"));
                             $("#detail_director").text($(this).attr("movie_director"));
                            $("#detail_actor").text($(this).attr("movie_actor"));
                            $("#detail_rating").text($(this).attr("movie_rating"));
                             $("#detail_img").attr("src",$(this).attr("movie_img"));
                             var genres = $(this).attr("movie_genres");
                             var genress = genres.split("|");
                             $("#detail_genres").html('');
                            for(var t=0;t<genress.length;t++){
                                if(t>0&&t%3==0){
                                     $("#detail_genres").append("<br>");
                                 }
                                 $("#detail_genres").append("<span class='label label-info' style='margin-left:3px;'>"+genress[t]+"</span>");
                            }
                            $("#detail_desc").text($(this).attr("movie_desc"));

                         });
                         td.append(a);
                         var td_info=$('<td></td>');
                         var recommend_data=msg.data[i]['fields']['recommend_score'];
                         var recommend_name="推荐系数";
                         if(recommend_data==null){
                             recommend_data=msg.data[i]['fields']['averating'];
                              recommend_name="评分";
                         }
                         var html='';
                         if(msg.data[i]['fields']['isnew']==1){
                             html='<strong><i class="fa fa-book margin-r-5"></i> 电影名称</strong> ' +
                            '<p class="text-muted" style="color:#F00">'+msg.data[i]['fields']['movie_name']+'</p>' +
                            '<strong><i class="fa fa-map-marker margin-r-5"></i> 年代</strong>' +
                            '<p class="text-muted" style="color:#F00">'+msg.data[i]['fields']['year']+'</p>' +
                            '<strong><i class="fa fa-signal margin-r-5"></i> '+recommend_name+'</strong>' +
                            '<p class="text-muted" style="color:#F00">'+recommend_data+'</p>';
                         }else{
                             html='<strong><i class="fa fa-book margin-r-5"></i> 电影名称</strong> ' +
                            '<p class="text-muted" >'+msg.data[i]['fields']['movie_name']+'</p>' +
                            '<strong><i class="fa fa-map-marker margin-r-5"></i> 年代</strong>' +
                             '<p class="text-muted" >'+msg.data[i]['fields']['year']+'</p>' +
                            '<strong><i class="fa fa-signal margin-r-5"></i> '+recommend_name+'</strong>' +
                            '<p class="text-muted" >'+recommend_data+'</p>';
                         }
                        td_info.html(html);
                         tr.append(td);
                         tr.append(td_info);
                         $("#movie_list").append(tr);
                     }
                }
            }
        });
    }

    function login_modal_hide(){
        $('#loginModal').modal('hide');
    }
    function register_modal_hide(){
        $('#registerModal').modal('hide');
    }

    function getVideoTypes(){
        obj = document.getElementsByName("video_type");
        check_val = "";
        for(k in obj){
            if(obj[k].checked){
                if(check_val==""){
                    check_val=check_val+obj[k].value;
                }else{
                    check_val=check_val+","+obj[k].value;
                }
            }
        }
        return check_val;
    }
</script>
</body>
</html>
